<!DOCTYPE html>
<html>
  <head>
    <title>Catbot</title>
    <style>
      @keyframes shimmer {
        100% {
          transform: translateX(100%);
        }
      }

      .animate-shimmer {
        position: relative;
        overflow: hidden;
        background-color: #1f2937;
      }

      .animate-shimmer::after {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        transform: translateX(-100%);
        background-image: linear-gradient(
          90deg,
          rgba(31, 41, 55, 0) 0,
          rgba(31, 41, 55, 0.2) 20%,
          rgba(31, 41, 55, 0.5) 60%,
          rgba(31, 41, 55, 0)
        );
        animation: shimmer 2s infinite;
        content: "";
      }
      .table-fixed {
        table-layout: fixed;
      }

      .table-row-fixed {
        height: 96px; /* Высота строки = высота картинки + padding */
      }

      .table-cell {
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      .cell-number {
        width: 48px;
      }
      .cell-image {
        width: 96px;
      }
      .cell-breed {
        width: 200px;
      }
      .cell-id {
        width: 100px;
      }
      .cell-likes {
        width: 120px;
      }
    </style>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-black text-white">
    <nav
      class="py-5 lg:fixed w-full bg-none backdrop-blur-2xl transition-all duration-500 z-50">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="w-full flex flex-col lg:flex-row">
          <div class="flex justify-between lg:flex-row">
            <button
              data-collapse-toggle="navbar"
              type="button"
              class="inline-flex items-center p-2 ml-3 text-sm text-gray-300 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
              aria-controls="navbar-default"
              aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg
                class="w-6 h-6"
                aria-hidden="true"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  fill-rule="evenodd"
                  d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                  clip-rule="evenodd"></path>
              </svg>
            </button>
          </div>
          <div class="hidden w-full lg:flex lg:pl-11 max-lg:py-4" id="navbar">
            <ul
              class="flex lg:items-center flex-col max-lg:gap-4 mt-4 lg:mt-0 lg:flex-row max-lg:mb-4">
              <li>
                <a
                  href="#"
                  class="text-gray-300 text-base lg:text-base font-medium hover:text-indigo-700 transition-all duration-500 mb-2 block lg:mr-6 md:mb-0 lg:text-left"
                  >Home
                </a>
              </li>
              <li>
                <a
                  href="#leaderboard"
                  class="text-gray-300 text-base lg:text-base font-medium hover:text-indigo-700 transition-all duration-500 mb-2 block lg:mr-6 md:mb-0 lg:text-left"
                  >Cats Top</a
                >
              </li>
            </ul>
            <div
              class="flex lg:items-center justify-start flex-col lg:flex-row max-lg:gap-4 lg:flex-1 lg:justify-end">
              <a href="https://github.com/kotru21">
                <button
                  class="bg-indigo-50 text-indigo-600 rounded-full cursor-pointer font-semibold text-center shadow-xs transition-all duration-500 py-3 px-6 text-sm hover:bg-indigo-100">
                  My GitHub
                </button>
              </a>
              <button
                class="bg-indigo-600 text-white rounded-full cursor-pointer font-semibold text-center shadow-xs transition-all duration-500 py-3 px-6 text-sm lg:ml-5 hover:bg-indigo-700">
                Bot's GitHub
              </button>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <section class="lg:pt-24 pt-0 lg:pl-8 h-full">
      <div
        class="rounded-2xl py-10 overflow-hidden m-5 lg:m-0 2xl:py-16 xl:py-8 lg:rounded-tl-2xl lg:rounded-bl-2xl">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div
            class="grid grid-cols-1 gap-14 items-center lg:grid-cols-12 lg:gap32">
            <div class="w-full xl:col-span-5 lg:col-span-6 2xl:-mx-5 xl:-mx-0">
              <div
                class="flex items-center text-sm font-medium text-gray-300 justify-center lg:justify-start">
                <span
                  class="bg-indigo-600 py-1 px-3 rounded-2xl text-xs font-medium text-white mr-3"
                  >#1</span
                >
                Bot based ob my own opinion
              </div>
              <h1
                class="py-8 text-center text-white font-bold font-manrope text-5xl lg:text-left leading-[70px]">
                Cat Bot for
                <span class="text-indigo-600">Telegram</span>
              </h1>
              <p class="text-gray-300 text-lg text-center lg:text-left">
                Literally the best bot in the world. It can send you random cat!
                And it's all you need in your life. Just try it!
              </p>
              <a href="https://t.me/catbotjss_bot">
                <div
                  class="relative p-1.5 my-10 flex items-center gap-y-4 h-auto md:h-16 flex-col md:flex-row gap-x-4">
                  <button
                    class="bg-indigo-600 rounded-full py-3 px-7 text-base font-semibold text-white hover:bg-indigo-700 cursor-pointer transition-all duration-500 md:w-fit w-full">
                    /fact
                  </button>
                  <button
                    class="border-indigo-600 border-2 rounded-full py-3 px-7 text-base font-semibold text-white hover:bg-indigo-700 cursor-pointer transition-all duration-500 md:w-fit w-full">
                    /about
                  </button>
                  <button
                    class="border-indigo-600 border-2 rounded-full py-3 px-7 text-base font-semibold text-white hover:bg-indigo-700 cursor-pointer transition-all duration-500 md:w-fit w-full">
                    /me
                  </button>
                </div>
              </a>
              <div class="flex items-center flex-col lg:flex-row">
                <div class="flex items-center">
                  <img
                    src="https://cdn2.thecatapi.com/images/u0xeq3HjW.jpg"
                    alt="Rounded image "
                    class="border-2 border-solid border-indigo-50 rounded-full relative z-50 object-cover w-10" />
                  <img
                    src="https://cdn2.thecatapi.com/images/Zi4jfH3c6.jpg"
                    alt="Rounded image"
                    class="border-2 border-solid border-indigo-50 rounded-full relative z-30 -ml-3 object-cover w-10" />
                  <img
                    src="https://cdn2.thecatapi.com/images/yPmEpKmnR.jpg"
                    alt="Rounded image"
                    class="border-2 border-solid border-indigo-50 rounded-full relative z-20 -ml-3 object-cover w-10" />
                </div>
                <span class="mt-3 text-base text-gray-600 font-medium lg:ml-3"
                  >Cats have joined</span
                >
              </div>
            </div>
            <div class="w-full xl:col-span-7 lg:col-span-6 block">
              <div class="w-full sm:w-auto lg:w-[60.8125rem] xl:ml-16">
                <div
                  class="max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                  <a href="#">
                    <h5
                      class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
                      Time from latest reload
                    </h5>
                  </a>
                  <p
                    class="mb-3 font-normal text-gray-700 dark:text-gray-400"
                    id="timeOutput">
                    Updating...
                  </p>
                </div>
                <div
                  class="max-w-sm p-6 mt-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                  <a href="#">
                    <h5
                      class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
                      Amount of messages sent
                    </h5>
                  </a>
                  <p
                    class="mb-3 font-normal text-gray-700 dark:text-gray-400"
                    id="messageOutput">
                    Updating...
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="container mx-auto px-4 py-16">
      <div
        class="lg:mx-24 p-6 dark:bg-gray-800 border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
        <h5
          class="mb-6 text-2xl font-bold tracking-tight text-gray-900 dark:text-white"
          id="leaderboard">
          Leaderboard
        </h5>
        <div class="relative flex items-center justify-center">
          <table
            class="w-full text-sm text-center rtl:text-right"
            id="leaderboard">
            <thead class="text-xs uppercase bg-gray-50 dark:bg-gray-700">
              <thead>
                <tr>
                  <th class="cell-number">#</th>
                  <th class="cell-image">Картинка</th>
                  <th class="cell-breed">Название породы</th>
                  <th class="cell-id">ID</th>
                  <th class="cell-likes">Количество лайков</th>
                </tr>
              </thead>
            </thead>

            <tbody>
              <template id="skeleton-row">
                <tr class="border-b dark:border-gray-700 table-row-fixed">
                  <td class="py-3 cell-number">
                    <div class="animate-shimmer h-4 w-4 mx-auto rounded"></div>
                  </td>
                  <td class="py-3 cell-image">
                    <div
                      class="animate-shimmer h-24 w-24 mx-auto rounded"></div>
                  </td>
                  <td class="py-3 cell-breed">
                    <div class="animate-shimmer h-4 w-32 mx-auto rounded"></div>
                  </td>
                  <td class="py-3 cell-id">
                    <div class="animate-shimmer h-4 w-16 mx-auto rounded"></div>
                  </td>
                  <td class="py-3 cell-likes">
                    <div class="animate-shimmer h-4 w-16 mx-auto rounded"></div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
      <footer class="text-center text-lg-start" style="color: white">
        <!-- Copyright -->
        <div class="text-center p-3">
          © 2025 Copyright:
          <a href="https://kotikov.is-a.dev/">Arsenij Kotikov</a>
        </div>
        <!-- Copyright -->
      </footer>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Селекторы
        const navbar = document.getElementById("navbar");
        const burgerBtn = document.querySelector(
          '[data-collapse-toggle="navbar"]'
        );
        const dropdownToggles = document.querySelectorAll(".dropdown-toggle");
        const megamenu = document.getElementById("megamenu");
        const dropdownFeature = document.getElementById("dropdown-feature");

        // Управление мобильным меню
        burgerBtn.addEventListener("click", () => {
          navbar.classList.toggle("hidden");
        });

        // Обработка выпадающих меню
        dropdownToggles.forEach((toggle) => {
          toggle.addEventListener("click", (e) => {
            const target = document.getElementById(
              e.currentTarget.dataset.target
            );

            // Закрыть другие меню
            if (target === megamenu) {
              dropdownFeature.classList.add("hidden");
            } else if (target === dropdownFeature) {
              megamenu.classList.add("hidden");
            }

            // Переключить текущее меню
            target.classList.toggle("hidden");

            // Повернуть стрелку
            e.currentTarget
              .querySelector(".dropdown-active-rotate-180")
              .classList.toggle("rotate-180");
          });
        });

        // Закрытие меню при клике вне
        document.addEventListener("click", (e) => {
          if (!e.target.closest(".dropdown")) {
            megamenu.classList.add("hidden");
            dropdownFeature.classList.add("hidden");

            // Сбросить все стрелки
            document
              .querySelectorAll(".dropdown-active-rotate-180")
              .forEach((arrow) => arrow.classList.remove("rotate-180"));
          }
        });
      });
    </script>
    <script type="module">
      const tableBody = document.querySelector("#leaderboard tbody");
      const skeletonTemplate = document.querySelector("#skeleton-row");

      function showSkeleton() {
        tableBody.innerHTML = "";
        for (let i = 0; i < 5; i++) {
          tableBody.appendChild(skeletonTemplate.content.cloneNode(true));
        }
      }

      const fetchLeaderboard = async () => {
        showSkeleton();

        try {
          const response = await fetch(
            `${window.location.origin}/api/leaderboard`
          );
          if (!response.ok) throw new Error("Failed to fetch leaderboard");
          const leaderboard = await response.json();

          tableBody.innerHTML = "";
          leaderboard.forEach((row, index) => {
            const tr = document.createElement("tr");
            tr.className = "border-b dark:border-gray-700";
            tr.innerHTML = `
          <td class="py-3">${index + 1}</td>
          <td class="py-3">
            <div class="relative w-24 h-24 mx-auto">
              <div class="animate-shimmer w-full h-full rounded absolute" id="skeleton-${
                row.id
              }"></div>
              <img src="${
                row.image_url
              }" class="w-full h-full object-cover rounded" alt="cat" 
                   onload="document.getElementById('skeleton-${
                     row.id
                   }').style.display='none'"/>
            </div>
          </td>
          <td class="py-3"><a href="/catDetails?id=${
            row.id
          }" class="underline">${row.breed_name}</a></td>
          <td class="py-3">${row.id}</td>
          <td class="py-3">${row.count}</td>
        `;
            tableBody.appendChild(tr);
          });
        } catch (err) {
          console.error(err);
          tableBody.innerHTML =
            '<tr><td colspan="5" class="py-3">Ошибка загрузки...</td></tr>';
        }
      };

      setInterval(fetchLeaderboard, 5000);
      fetchLeaderboard();
    </script>
    <script type="module">
      const messageOutputDiv = document.getElementById("messageOutput"); // Element, to display amount of messages in it
      const timeOutputDiv = document.getElementById("timeOutput"); // Element, to display amount of time from startup in it
      const ws = new WebSocket(`wss://${window.location.hostname}/wss`);

      ws.onopen = () => {
        console.log("Connected to server");
      };

      ws.onmessage = (event) => {
        const { messageCount, uptimeDateObject } = JSON.parse(event.data);
        const startDate = new Date(uptimeDateObject);
        messageOutputDiv.textContent = messageCount;

        const formatTimeDifference = (startDate) => {
          const currentDate = new Date();
          const timeDifference = currentDate - startDate;
          const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
          const hours = Math.floor((timeDifference / (1000 * 60 * 60)) % 24);
          const minutes = Math.floor((timeDifference / (1000 * 60)) % 60);
          const seconds = Math.floor((timeDifference / 1000) % 60);
          return `${days} дней, ${hours} час(ов), ${minutes} минут(ы), ${seconds} секунд(ы)`;
        };

        const updateCounter = () => {
          timeOutputDiv.textContent = formatTimeDifference(startDate);
        };

        updateCounter(); // Вызов обновления счётчика
      };

      ws.onclose = () => {
        console.log("Disconnected from server");
      };
    </script>
  </body>
</html>
