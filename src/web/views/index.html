<!DOCTYPE html>
<html>
  <head>
    <title>Catbot</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.4;
        }
        100% {
          opacity: 0.6;
        }
      }
      .animate-shimmer {
        background-color: #374151;
        animation: pulse 1.5s infinite;
      }
      .skeleton-text {
        height: 0.75rem;
        width: 100%;
        border-radius: 0.25rem;
      }
      .loader-content {
        display: block;
      }
      .loaded-content {
        display: none;
      }
      /* Изменения стилей здесь */
      .skeleton-content {
        display: block;
      }
      .real-content {
        display: none;
      }
    </style>
  </head>
  <body class="bg-black text-white">
    <nav
      class="py-5 lg:fixed w-full bg-none backdrop-blur-2xl transition-all duration-500 z-50">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="w-full flex flex-col lg:flex-row">
          <div class="flex justify-between lg:flex-row">
            <button
              data-collapse-toggle="navbar"
              type="button"
              class="inline-flex items-center p-2 ml-3 text-sm text-gray-300 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200"
              aria-controls="navbar-default"
              aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <svg
                class="w-6 h-6"
                aria-hidden="true"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  fill-rule="evenodd"
                  d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                  clip-rule="evenodd"></path>
              </svg>
            </button>
          </div>
          <div class="hidden w-full lg:flex lg:pl-11 max-lg:py-4" id="navbar">
            <ul
              class="flex lg:items-center flex-col max-lg:gap-4 mt-4 lg:mt-0 lg:flex-row max-lg:mb-4">
              <li>
                <a
                  href="#"
                  class="text-gray-300 text-base lg:text-base font-medium hover:text-indigo-700 transition-all duration-500 mb-2 block lg:mr-6 md:mb-0 lg:text-left"
                  >Home
                </a>
              </li>
              <li>
                <a
                  href="#leaderboard"
                  class="text-gray-300 text-base lg:text-base font-medium hover:text-indigo-700 transition-all duration-500 mb-2 block lg:mr-6 md:mb-0 lg:text-left"
                  >Cats Top</a
                >
              </li>
            </ul>
            <div
              class="flex lg:items-center justify-start flex-col lg:flex-row max-lg:gap-4 lg:flex-1 lg:justify-end">
              <a href="https://github.com/kotru21">
                <button
                  class="bg-indigo-50 text-indigo-600 rounded-full cursor-pointer font-semibold text-center shadow-xs transition-all duration-500 py-3 px-6 text-sm hover:bg-indigo-100">
                  My GitHub
                </button>
              </a>
              <button
                class="bg-indigo-600 text-white rounded-full cursor-pointer font-semibold text-center shadow-xs transition-all duration-500 py-3 px-6 text-sm lg:ml-5 hover:bg-indigo-700">
                Bot's GitHub
              </button>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <section class="lg:pt-24 pt-0 lg:pl-8 h-full">
      <div
        class="rounded-2xl py-10 overflow-hidden m-5 lg:m-0 2xl:py-16 xl:py-8 lg:rounded-tl-2xl lg:rounded-bl-2xl">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div
            class="grid grid-cols-1 gap-14 items-center lg:grid-cols-12 lg:gap32">
            <div class="w-full xl:col-span-5 lg:col-span-6 2xl:-mx-5 xl:-mx-0">
              <div
                class="flex items-center text-sm font-medium text-gray-300 justify-center lg:justify-start">
                <span
                  class="bg-indigo-600 py-1 px-3 rounded-2xl text-xs font-medium text-white mr-3"
                  >#1</span
                >
                Bot based ob my own opinion
              </div>
              <h1
                class="py-8 text-center text-white font-bold font-manrope text-5xl lg:text-left leading-[70px]">
                Cat Bot for
                <span class="text-indigo-600">Telegram</span>
              </h1>
              <p class="text-gray-300 text-lg text-center lg:text-left">
                Literally the best bot in the world. It can send you random cat!
                And it's all you need in your life. Just try it!
              </p>
              <a href="https://t.me/catbotjss_bot">
                <div
                  class="relative p-1.5 my-10 flex items-center gap-y-4 h-auto md:h-16 flex-col md:flex-row gap-x-4">
                  <button
                    class="bg-indigo-600 rounded-full py-3 px-7 text-base font-semibold text-white hover:bg-indigo-700 cursor-pointer transition-all duration-500 md:w-fit w-full">
                    /fact
                  </button>
                  <button
                    class="border-indigo-600 border-2 rounded-full py-3 px-7 text-base font-semibold text-white hover:bg-indigo-700 cursor-pointer transition-all duration-500 md:w-fit w-full">
                    /about
                  </button>
                  <button
                    class="border-indigo-600 border-2 rounded-full py-3 px-7 text-base font-semibold text-white hover:bg-indigo-700 cursor-pointer transition-all duration-500 md:w-fit w-full">
                    /me
                  </button>
                </div>
              </a>
              <div class="flex items-center flex-col lg:flex-row">
                <div class="flex items-center">
                  <img
                    src="https://cdn2.thecatapi.com/images/u0xeq3HjW.jpg"
                    alt="Rounded image "
                    class="border-2 border-solid border-indigo-50 rounded-full relative z-50 object-cover w-10" />
                  <img
                    src="https://cdn2.thecatapi.com/images/Zi4jfH3c6.jpg"
                    alt="Rounded image"
                    class="border-2 border-solid border-indigo-50 rounded-full relative z-30 -ml-3 object-cover w-10" />
                  <img
                    src="https://cdn2.thecatapi.com/images/yPmEpKmnR.jpg"
                    alt="Rounded image"
                    class="border-2 border-solid border-indigo-50 rounded-full relative z-20 -ml-3 object-cover w-10" />
                </div>
                <span class="mt-3 text-base text-gray-600 font-medium lg:ml-3"
                  >Cats have joined</span
                >
              </div>
            </div>
            <div class="w-full xl:col-span-7 lg:col-span-6 block">
              <div class="w-full sm:w-auto lg:w-[60.8125rem] xl:ml-16">
                <div
                  class="max-w-sm p-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                  <a href="#">
                    <h5
                      class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
                      Time from latest reload
                    </h5>
                  </a>
                  <!-- Скелетон-лоадер для времени -->
                  <div id="timeLoader" class="skeleton-content">
                    <div class="animate-shimmer skeleton-text mb-2"></div>
                    <div class="animate-shimmer skeleton-text w-4/5 mt-3"></div>
                  </div>
                  <!-- Реальный контент -->
                  <p
                    class="mb-3 font-normal text-gray-700 dark:text-gray-400 real-content"
                    id="timeOutput">
                    Updating...
                  </p>
                </div>
                <div
                  class="max-w-sm p-6 mt-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                  <a href="#">
                    <h5
                      class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
                      Amount of messages sent
                    </h5>
                  </a>
                  <!-- Скелетон-лоадер для сообщений -->
                  <div id="messageLoader" class="skeleton-content">
                    <div class="animate-shimmer skeleton-text h-4"></div>
                  </div>
                  <!-- Реальный контент -->
                  <p
                    class="mb-3 font-normal text-gray-700 dark:text-gray-400 real-content"
                    id="messageOutput">
                    Updating...
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="container mx-auto px-4 py-16">
      <div
        class="lg:mx-24 p-6 dark:bg-gray-800 border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
        <h5
          class="mb-6 text-2xl font-bold tracking-tight text-gray-900 dark:text-white"
          id="leaderboard">
          Leaderboard
        </h5>
        <div class="relative flex items-center justify-center">
          <table
            class="w-full text-sm text-center rtl:text-right"
            id="leaderboard">
            <thead class="text-xs uppercase bg-gray-50 dark:bg-gray-700">
              <thead>
                <tr>
                  <th class="cell-number">#</th>
                  <th class="cell-image">Картинка</th>
                  <th class="cell-breed">Название породы</th>
                  <th class="cell-id">ID</th>
                  <th class="cell-likes">Количество лайков</th>
                </tr>
              </thead>
            </thead>

            <tbody>
              <template id="skeleton-row">
                <tr class="border-b dark:border-gray-700">
                  <td class="py-3">
                    <div class="animate-shimmer h-4 w-4 mx-auto rounded"></div>
                  </td>
                  <td class="py-3 flex justify-center">
                    <div
                      class="animate-shimmer h-24 w-24 rounded"
                      style="margin: 0 auto"></div>
                  </td>
                  <td class="py-3">
                    <div class="animate-shimmer h-4 w-32 mx-auto rounded"></div>
                  </td>
                  <td class="py-3">
                    <div class="animate-shimmer h-4 w-16 mx-auto rounded"></div>
                  </td>
                  <td class="py-3">
                    <div class="animate-shimmer h-4 w-16 mx-auto rounded"></div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
      <footer class="text-center text-lg-start" style="color: white">
        <!-- Copyright -->
        <div class="text-center p-3">
          © 2025 Copyright:
          <a href="https://kotikov.is-a.dev/">Arsenij Kotikov</a>
        </div>
        <!-- Copyright -->
      </footer>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Селекторы
        const navbar = document.getElementById("navbar");
        const burgerBtn = document.querySelector(
          '[data-collapse-toggle="navbar"]'
        );
        const dropdownToggles = document.querySelectorAll(".dropdown-toggle");
        const megamenu = document.getElementById("megamenu");
        const dropdownFeature = document.getElementById("dropdown-feature");

        // Управление мобильным меню
        burgerBtn.addEventListener("click", () => {
          navbar.classList.toggle("hidden");
        });

        // Обработка выпадающих меню
        dropdownToggles.forEach((toggle) => {
          toggle.addEventListener("click", (e) => {
            const target = document.getElementById(
              e.currentTarget.dataset.target
            );

            // Закрыть другие меню
            if (target === megamenu) {
              dropdownFeature.classList.add("hidden");
            } else if (target === dropdownFeature) {
              megamenu.classList.add("hidden");
            }

            // Переключить текущее меню
            target.classList.toggle("hidden");

            // Повернуть стрелку
            e.currentTarget
              .querySelector(".dropdown-active-rotate-180")
              .classList.toggle("rotate-180");
          });
        });

        // Закрытие меню при клике вне
        document.addEventListener("click", (e) => {
          if (!e.target.closest(".dropdown")) {
            megamenu.classList.add("hidden");
            dropdownFeature.classList.add("hidden");

            // Сбросить все стрелки
            document
              .querySelectorAll(".dropdown-active-rotate-180")
              .forEach((arrow) => arrow.classList.remove("rotate-180"));
          }
        });
      });
    </script>
    <script type="module">
      const tableBody = document.querySelector("#leaderboard tbody");
      const skeletonTemplate = document.querySelector("#skeleton-row");

      // Функция для показа скелетон-лоадеров
      function showSkeletons(count = 5) {
        tableBody.innerHTML = "";
        for (let i = 0; i < count; i++) {
          const clone = document.importNode(skeletonTemplate.content, true);
          tableBody.appendChild(clone);
        }
      }

      // Показываем скелетоны сразу
      showSkeletons();

      const fetchLeaderboard = async () => {
        try {
          const response = await fetch(
            `${window.location.origin}/api/leaderboard`
          );
          if (!response.ok) throw new Error("Failed to fetch leaderboard");
          const leaderboard = await response.json();

          // Добавим небольшую задержку для лучшего пользовательского опыта
          setTimeout(() => {
            tableBody.innerHTML = "";

            if (leaderboard.length === 0) {
              tableBody.innerHTML =
                '<tr><td colspan="5" class="text-center py-4">Нет данных для отображения</td></tr>';
              return;
            }

            leaderboard.forEach((row, index) => {
              const tr = document.createElement("tr");
              tr.className = "border-b dark:border-gray-700";
              tr.innerHTML = `
                <td>${index + 1}</td>
                <td class="flex justify-center">
                  <img src="${row.image_url}" 
                       class="w-24 h-24 object-cover rounded" 
                       alt="cat"
                       onerror="this.src='https://via.placeholder.com/96?text=No+Image'" />
                </td>
                <td><a href="${"/catDetails?id=" + row.id}" class="underline">${
                row.breed_name
              }</a></td>
                <td>${row.id}</td>
                <td>${row.count}</td>
              `;
              tableBody.appendChild(tr);
            });
          }, 500); // Небольшая задержка для плавности
        } catch (err) {
          console.error(err);
          tableBody.innerHTML =
            '<tr><td colspan="5" class="text-center py-4">Ошибка загрузки. Пожалуйста, попробуйте позже.</td></tr>';
        }
      };

      // Периодическое обновление лидерборда
      fetchLeaderboard();
      setInterval(fetchLeaderboard, 5000);
    </script>

    <script type="module">
      const messageOutputDiv = document.getElementById("messageOutput");
      const timeOutputDiv = document.getElementById("timeOutput");
      const messageLoader = document.getElementById("messageLoader");
      const timeLoader = document.getElementById("timeLoader");

      const ws = new WebSocket(
        `ws://${window.location.hostname}:{{apiPort}}/wss`
      );

      // Гарантируем, что лоадеры видны при загрузке страницы
      messageLoader.classList.add("skeleton-content");
      timeLoader.classList.add("skeleton-content");
      messageOutputDiv.classList.add("real-content");
      timeOutputDiv.classList.add("real-content");

      // Ожидаем минимум 1.5 секунды для отображения скелетонов
      let dataReceived = false;
      setTimeout(() => {
        if (dataReceived) {
          showContent();
        }
      }, 1500);

      function showContent() {
        // Скрываем лоадеры и показываем контент
        messageLoader.classList.remove("skeleton-content");
        timeLoader.classList.remove("skeleton-content");
        messageLoader.style.display = "none";
        timeLoader.style.display = "none";

        messageOutputDiv.classList.remove("real-content");
        timeOutputDiv.classList.remove("real-content");
        messageOutputDiv.style.display = "block";
        timeOutputDiv.style.display = "block";
      }

      ws.onopen = () => {
        console.log("Connected to server");
      };

      ws.onmessage = (event) => {
        dataReceived = true;
        const { messageCount, uptimeDateObject } = JSON.parse(event.data);
        const startDate = new Date(uptimeDateObject);

        messageOutputDiv.textContent = messageCount;

        const formatTimeDifference = (startDate) => {
          const currentDate = new Date();
          const timeDifference = currentDate - startDate;
          const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
          const hours = Math.floor((timeDifference / (1000 * 60 * 60)) % 24);
          const minutes = Math.floor((timeDifference / (1000 * 60)) % 60);
          const seconds = Math.floor((timeDifference / 1000) % 60);
          return `${days} дней, ${hours} час(ов), ${minutes} минут(ы), ${seconds} секунд(ы)`;
        };

        const updateCounter = () => {
          timeOutputDiv.textContent = formatTimeDifference(startDate);
        };

        updateCounter();
        setInterval(updateCounter, 1000);

        // Показываем контент с задержкой для лучшего UX
        setTimeout(showContent, 500);
      };

      ws.onclose = () => {
        console.log("Disconnected from server");
        showContent();
        messageOutputDiv.textContent = "Соединение с сервером потеряно";
        timeOutputDiv.textContent = "Соединение с сервером потеряно";
      };

      ws.onerror = (error) => {
        console.error("WebSocket error:", error);
        showContent();
        messageOutputDiv.textContent = "Ошибка подключения к серверу";
        timeOutputDiv.textContent = "Ошибка подключения к серверу";
      };
    </script>
  </body>
</html>
